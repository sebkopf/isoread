---
title: "Dual Inlet Intro"
output: html_document
---

## Installation (not run)

```{r, eval=FALSE}
install.packages('devtools', depen=T) 
library(devtools)
install_github('sebkopf/isotopia')
install_github('isoread', 'sebkopf')
```

Here, we read two simple dual inlet isodat files that are provided as examples in the module. **isoread** takes all the information directly from the binary, which makes it easy to record each step of what is happening with the data. 

# Oxygen isotope data

First, we load an oxygen isotope dual inlet file (`type = "O2_DI"`). The specialized implementation of the oxygen data file allows direct access to all the data summary values in addition to the raw voltage readings. However, the raw mass data could be read from any dual inlet (`.did`) file by specifiying `type = "DUAL"`.

```{r load-o2}
library(isoread)
file <- isoread(system.file("extdata", "dual_inlet_O2.did", package="isoread"), type = "O2_DI")
```

The `file` variable now contains an isoread object with all the information from the binary file and we can take a look at the data it holds.

## Raw data

The raw voltages provide information on the signal stability between the sample and standard for all recorded masses. Here, we are using the k-table or `kable` command from the `knitr` package for lightly formatted table output. Instead, we can also just retrieve the raw mass data as a data frame using the `get_mass_data()` method, which, if needed, can be easily exported to a csv file using the `export_data(type="raw")` method (data export is described in more details later). 

```{r raw-data-o2, results='asis'}
library(knitr)
kable(file$get_mass_data())
```

#### Visualiztion

For convenience, **isoread** also implements several plotting functions so we can quickly visualize the raw data. The `make_ggplot()` method generates a `ggplot2` plot object which can be printed (or saved as a PDF) as is, or modified using all functionality provided by the `ggplot2` - here for example, with the addition of a figure caption.

```{r raw-data-plot-o2, fig.width=10, fig.height=7}
file$make_ggplot() + labs(title = "Raw mass voltages plot")
```

#### Or only a few masses

The `make_ggplot()` method can take additional parameters to plot only specific masses of interest.

```{r subset-o2}
file$make_ggplot(masses = c("mass32", "mass34"))
```

## Processed data

#### Whole table

The entire table of processed data.

```{r processed-data-all-o2, results='asis'}
kable(file$get_data_table())
```

#### Summary

```{r processed-data-sum-o2, results='asis'}
kable(file$get_data_table(summarize = TRUE))
```

#### Or only a few of these

```{r processed-subset-o2, results='asis'}
kable(file$get_data_table(select = c("d13C", "d18O"), sum = T))
```

## File information

Since **isoread** has access to the original raw binary data file, it can extract other parameters stored with the data. These are the ones currently retrieved by the O2 dual inlet implementation:

```{r file-info-o2, results='asis'}
kable(file$get_info())
```

## Data export

```{r file-export-o2}
file$export_data(file = "my_file_raw.csv", type = "raw")
file$export_data(file = "my_file_table.csv", type = "table")
file$export_data(file = "my_file_summary.csv", type = "summary")
file$export_data(file = "my_file_info.csv", type = "info")
```


# Clumped carbonate isotope data

The second example is a dual inlet analysis for clumped CO2 measurements. The same way as for the O2, the specialized implementation of the **"CO2_CLUMPED"** data type allows direct acess to all the data summary values in addition to the raw voltage readings of the dual inlet data.

```{r load}
library(isoread)
file <- isoread(system.file("extdata", "dual_inlet_clumped_carbonate.did", package="isoread"), type = "CO2_CLUMPED")
```

## Raw data

```{r raw-data, results='asis', fig.width=10, fig.height=7}
library(knitr)
kable(file$get_mass_data())
file$make_ggplot()
```

#### Or only a few masses

```{r subset}
file$make_ggplot(masses = c("mass44", "mass47"))
```

## Processed data

#### Whole table

The entire table of processed data.

```{r processed-data-all, results='asis'}
kable(file$get_data_table())
```

#### Summary

```{r processed-data-sum, results='asis'}
kable(file$get_data_table(summarize = TRUE))
```

#### Or only a few of these

```{r processed-subset, results='asis'}
kable(file$get_data_table(select = c("d13C", "d18O"), sum = T))
```

## Other info

And whatever other information was pulled out of the file.

```{r file-info, results='asis'}
kable(file$get_info())
```
